---
layout:     post
title:      消息队列
subtitle:   消息队列概述
date:       2018-05-19
author:     bright
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
- 编程
- 消息中间件
---

### 1.概要
```
在计算机科学中，消息队列是用于进程间通信(IPC)的软件工程组件，或者用于同一进程内的线程间通信。它们使用队列进行消息传递——控制或内容的传递。
消息队列范式是发布/订阅模式的模式，通常是更大的面向消息中间件系统的一部分。大多数消息传递系统都在其API中支持发布/订阅者和消息队列模型，例如

javascript
Java message Service(JMS)
消息队列提供了异步通信协议，这意味着消息的发送方和接收方不需要同时与消息队列进行交互。放置在队列上的消息被存储，直到接收方检索它们。消息队列对可能在单个消息中传输的数据的大小有隐式或显式的限制，以及可能在队列中保持剩余的消息的数量。


消息队列的许多实现都是内部的:在一个操作系统内或在一个应用程序内。这样的队列存在的目的仅是为了该系统
其他实现允许在不同的计算机系统之间传递消息，可能连接多个应用程序和多个操作系统。这些消息队列系统通常提供增强的弹性功能，以确保在系统故障时消息不会“丢失”。这种消息队列软件(也称为面向消息的中间件)的商业实现的示例包括IBM WebSphere MQ和Oracle高级队列(AQ)，JMS（Java Message Service）。

消息队列有很长的历史，包括从消息队列开始的产品，如IBM WebSphere MQ，以及与特定操作系统绑定的产品，如Microsoft消息队列。
还有基于云的消息队列服务选项，如Amazon Simple Queue service(SQS)、风暴mq和IronMQ。

消息中间件系统有许多开放源码的选择，包括Apache ActiveMQ、Apache卡夫卡、Apache Qpid、Beanstalkd、HTTPSQS,JBoss消息、JORAM、RabbitMQ、Sun开放消息队列和Tarantool。

大多数实时操作系统(RTOSes)，例如VxWorks和QNX，都鼓励使用消息排队作为主要的进程间或线程间通信机制。消息传递和CPU调度之间的紧密集成被认为是实时应用程序可用性的主要原因。早期的商业RTOSes的例子，鼓励消息队列根据线程间通信，也包括VRTX和pSOS+，这两者都可以追溯到上世纪80年代早期。Erlang编程语言使用进程来提供并发性;这些进程使用消息队列进行异步通信。

在典型的消息队列实现中，系统管理员安装和配置消息队列软件(队列管理器或代理)，并定义一个命名消息队列。应用程序注册一个软件例程，该例程“监听”放置在队列上的消息。随后的应用程序可能连接到队列并将消息传输到它上。
```

### 2.使用影响因子

```
持久性——消息可以保存在内存中，写到磁盘上，甚至可以提交给DBMS，如果可靠性需要表明一个更资源化的解决方案。
1. 安全策略——哪些应用程序应该能够访问这些消息?
1. 消息清除策略——队列或消息可能有“生存时间”
1. 消息过滤——一些系统支持过滤数据，以便订阅者可能只看到符合预先指定的兴趣标准的消息
1. 交付策略——我们是否需要保证消息至少传递一次，或者不超过一次?
1. 路由策略——在一个有许多队列服务器的系统中，哪些服务器应该接收消息或队列的消息?
1. 批处理策略——应该立即发送消息吗?或者，系统是否应该等待一段时间，并尝试同时传递多个消息?
排队条件——什么时候应该将消息视为“排队”?当一个队列有它的时候?或者当它被转发到至少一个远程队列时?还是所有队列?
接收通知-发布者可能需要知道什么时候或所有的订阅者收到消息。
这些都是对事务语义、系统可靠性和系统效率有实质性影响的考虑因素。
```

### 3.标准和协议

```
在开放源码消息队列实现中使用了三个标准:

1. 高级消息队列协议(AMQP)——功能丰富的消息队列协议
1. 面向文本的消息传递协议(STOMP)——简单的、面向文本的消息协议
1. MQTT(以前是MQ遥测传输)——轻量级消息队列协议，特别是用于嵌入式设备

前两种基于http协议，MQTT基于TCP/IP协议层级
```

### 4.同步 vs 异步

```
同步协议场景：许多更广为人知的通信协议都是同步运行的。HTTP协议——在万维网和Web服务中使用——提供了一个明显的例子，用户向Web页面发送请求，然后等待应答。
同步不适合场景：例如，AJAX(异步JavaScript和XML)可以用于异步发送文本、JSON或XML消息，以更新具有更相关信息的web页面的一部分。
Google搜索中使用这种方法，它将用户的部分类型的查询发送到Google的服务器，并返回用户可能正在输入的完整查询列表。这个列表是作为用户类型异步更新的。

应用程序不需要完全同步或异步。交互式应用程序可能需要立即响应一个请求(比如告诉客户销售请求已被接受,并处理库存信息）,消息的某些部分一段时间以后处理队列其他部分(如完成计算计费,转发数据到中央计费系统,并调用各种其他服务)。

在所有这些情况下，拥有一个消息队列(或者一个广播消息传递系统)的子系统可以帮助改进整个系统的行为。
```

### 5.在UNIX中的实现

```
在UNIX中有两个常见的消息队列实现。一个是SYS V API的一部分，另一个是POSIX的一部分。
```
